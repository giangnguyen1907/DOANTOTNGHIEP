<?php

/**
 * PsFeatureBranchSyntheticTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class PsFeatureBranchSyntheticTable extends Doctrine_Table {

	/**
	 * Returns an instance of this class.
	 *
	 * @return object PsFeatureBranchSyntheticTable
	 */
	public static function getInstance() {

		return Doctrine_Core::getTable ( 'PsFeatureBranchSynthetic' );
	}

	public function getPsFeatureBranchSyntheticByClass($class_id, $feature_branch_id, $date) {

		$query = $this->createQuery ( 'a' );
		$query->select ( 'a.id,a.feature_id,a.feature_sum,a.tracked_at' );
		$query->addWhere ( 'a.ps_class_id =?', $class_id );
		$query->addWhere ( 'a.feature_id =?', $feature_branch_id );
		$query->andWhere ( 'DATE_FORMAT(a.tracked_at,"%Y%m%d") = ?', date ( "Ymd", strtotime ( $date ) ) );
		return $query->fetchOne ();
	}

	public function getPsFeatureBranchByClassInMonth($class_id, $date) {

		$query = $this->createQuery ( 'a' );
		$query->select ( 'a.id,a.feature_id,a.feature_sum,a.tracked_at' );
		$query->addSelect ( 'fbt.start_at as start_at, fbt.end_at as end_at,fb.id as fb_id,fbt.id as fbt_id' );
		$query->leftJoin ( 'a.FeatureBranch fb' );
		$query->leftJoin ( 'fb.FeatureBranchTimes fbt' );
		$query->addWhere ( 'a.ps_class_id =?', $class_id );
		$query->andWhere ( 'DATE_FORMAT(a.tracked_at,"%Y%m") = ?', date ( "Ym", strtotime ( $date ) ) );
		return $query->execute ();
	}

	public function getPsFeatureBranchByCustomerInMonth($ps_customer_id, $date) {

		$query = $this->createQuery ( 'a' );
		$query->select ( 'a.id,a.feature_id,a.feature_sum,a.tracked_at,a.ps_customer_id,a.ps_class_id' );
		$query->addSelect ( 'fbt.start_at as start_at, fbt.end_at as end_at,fb.id as fb_id,fb.name as name,fbt.id as fbt_id' );
		$query->leftJoin ( 'a.FeatureBranch fb' );
		$query->leftJoin ( 'fb.FeatureBranchTimes fbt' );
		$query->addWhere ( 'a.ps_customer_id =?', $ps_customer_id );
		$query->andWhere ( 'DATE_FORMAT(a.tracked_at,"%Y%m") = ?', date ( "Ym", strtotime ( $date ) ) );
		return $query->execute ();
	}

	public function getPsFeatureBranchByCustomerInDay($ps_customer_id, $date) {

		$query = $this->createQuery ( 'a' );
		$query->select ( 'a.id,a.feature_id,a.feature_sum,a.tracked_at,a.ps_customer_id,a.ps_class_id' );
		$query->addSelect ( 'fbt.start_at as start_at, fbt.end_at as end_at,fb.id as fb_id,fbt.id as fbt_id' );
		$query->leftJoin ( 'a.FeatureBranch fb' );
		$query->leftJoin ( 'fb.FeatureBranchTimes fbt' );
		$query->addWhere ( 'a.ps_customer_id =?', $ps_customer_id );
		$query->andWhere ( 'DATE_FORMAT(a.tracked_at,"%Y%m%d") = ?', date ( "Ymd", strtotime ( $date ) ) );
		return $query->execute ();
	}
}