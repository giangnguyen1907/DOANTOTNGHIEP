<?php

/**
 * ReceivableDetailTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class ReceivableDetailTable extends Doctrine_Table {

	/**
	 * Returns an instance of this class.
	 *
	 * @return object ReceivableDetailTable
	 */
	public static function getInstance() {

		return Doctrine_Core::getTable ( 'ReceivableDetail' );
	}

	/**
	 * Lay ra cac khoan phai thu khac cua hoc sinh
	 *
	 * @author Phung Van Thanh
	 */
	public function getAllReceivableDetail($receivable_id) {

		$q = $this->createQuery ( 'fr' )
			->select ( 'fr.*' );
		$q->addWhere ( 'fr.receivable_id =?', $receivable_id );
		$q->orderBy ( 'fr.id' );
		return $q->execute ();
	}

	/**
	 * Lay ra cac khoan phai thu khac theo thoi diem
	 *
	 * @author Phung Van Thanh
	 */
	public function getAllReceivableDetailDate($receivable_id, $date_at) {

		$q = $this->createQuery ( 'fr' )
			->select ( 'fr.*' );
		$q->addWhere ( 'fr.receivable_id =?', $receivable_id );
		$q->addWhere ( 'DATE_FORMAT(fr.detail_at, "%Y%m") <=? AND DATE_FORMAT(fr.detail_end, "%Y%m") >=?', array (
				date ( 'Ym', strtotime ( $date_at ) ),
				date ( 'Ym', strtotime ( $date_at ) ) ) );
		$q->orderBy ( 'fr.id' );
		return $q->execute ();
	}
}