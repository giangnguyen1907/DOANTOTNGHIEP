<?php

/**
 * PsEvaluateSemesterTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class PsEvaluateSemesterTable extends Doctrine_Table {

	/**
	 * Returns an instance of this class.
	 *
	 * @return object PsEvaluateSemesterTable
	 */
	public static function getInstance() {

		return Doctrine_Core::getTable ( 'PsEvaluateSemester' );
	}

	public function doSelectQuery(Doctrine_Query $query) {

		$query = Doctrine_Query::create ()->from ( 'PsEvaluateSemester es' );

		$query->select ( 's.id as student_id, s.student_code as student_code, CONCAT(s.first_name, " ", s.last_name) AS student_name' );

		$query->addSelect ( 'es.id as id,es.student_id as student_id, es.title as title,es.is_public as is_public,es.path_file as path_file, es.file as file,es.url_file as url_file ' );

		$query->addSelect ( 'CONCAT(u.first_name, " ", u.last_name) AS updated_by' );

		$query->leftJoin ( 'es.UserUpdated u' );

		$query->leftJoin ( 'es.Student s' );

		$query->leftJoin ( 's.StudentClass sc' );

		$query->leftJoin ( 'sc.MyClass mc' );

		$query->innerJoin ( 's.PsCustomer cus' );

		$query->addWhere ( 's.deleted_at IS NULL' );

		if (! myUser::credentialPsCustomers ( 'PS_SYSTEM_FEATURE_BRANCH_FILTER_SCHOOL' ) && myUser::getPscustomerID () > 0) {
			$query->addWhere ( 's.ps_customer_id = ?', myUser::getPscustomerID () );
		}

		return $query;
	}
}