<?php

/**
 * PsCameraTable
 *
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class PsCameraTable extends Doctrine_Table {

	/**
	 * Returns an instance of this class.
	 *
	 * @return object PsCameraTable
	 */
	public static function getInstance() {

		return Doctrine_Core::getTable ( 'PsCamera' );
	}

	/**
	 * FUNCTION: doSelectQuery(Doctrine_Query $query)
	 *
	 * @param
	 *        	Doctrine SQL
	 * @return string SQL
	 */
	public function doSelectQuery(Doctrine_Query $query) {

		$a = $query->getRootAlias ();

		$query->select ( $a . '.id AS id, ' . $a . '.title AS title, ' . $a . '.user_camera AS user_camera, ' . $a . '.password_camera AS password_camera, ' . $a . '.iorder AS iorder, ' . $a . '.image_name AS image_name, ' . $a . '.url_ip AS url_ip, ' . $a . '.note AS note, ' . $a . '.is_activated AS is_activated, ' . $a . '.updated_at AS updated_at,cr.id AS ps_cr_id,wp.id AS wp_id,cus.school_code AS school_code,' . 'CONCAT(u.first_name, " ", u.last_name) AS updated_by' );

		$query->leftJoin ( $a . '.UserUpdated u' );
		$query->leftJoin ( $a . '.PsClassRooms cr' );
		$query->leftJoin ( 'cr.PsWorkPlaces wp' );
		$query->innerJoin ( 'wp.PsCustomer cus' );

		if (! myUser::credentialPsCustomers ( 'PS_SYSTEM_CAMERA_FILTER_SCHOOL' ) && myUser::getPscustomerID () > 0) {
			$query->where ( $a . '.ps_class_room_id = ?', myUser::getPscustomerID () );
		}

		return $query;
	}
}


