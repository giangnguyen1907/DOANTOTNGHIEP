<?php

/**
 * PsReceivableTemporaryTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class PsReceivableTemporaryTable extends Doctrine_Table {

	/**
	 * Returns an instance of this class.
	 *
	 * @return object PsReceivableTemporaryTable
	 */
	public static function getInstance() {

		return Doctrine_Core::getTable ( 'PsReceivableTemporary' );
	}

	public function doSelectQuery(Doctrine_Query $query) {

		$a = $query->getRootAlias ();

		$query->select ( $a . '.id AS id,' . $a . '.receivable_id AS receivable_id,' . $a . '.amount AS amount,' . $a . '.receivable_at AS receivable_at,' . $a . '.note AS 	note,' . 'CONCAT(u.first_name, " ", u.last_name) AS updated_by,' . $a . '.updated_at AS updated_at, ' );

		$query->addSelect ( 's.id AS student_id, s.image AS image, s.student_code AS student_code, CONCAT(s.first_name, " ", s.last_name) AS student_name,' );

		$query->addSelect ( 'rc.id, rc.title AS receivable_title,' );

		$query->addSelect ( 's.year_data AS year_data , cus.school_code AS school_code,' );
		$query->leftJoin ( $a . '.Student s' );

		$query->leftJoin ( $a . '.UserUpdated u' );

		$query->leftJoin ( $a . '.Receivable rc' );

		$query->innerJoin ( 's.PsCustomer cus' );

		if (! myUser::credentialPsCustomers ( 'PS_FEE_REPORT_FILTER_SCHOOL' ) && myUser::getPscustomerID () > 0) {
			$query->where ( 'rc.ps_customer_id = ?', myUser::getPscustomerID () );
		}

		$query->orderBy ( 's.last_name,s.first_name' );

		return $query;
	}
}