<?php

/**
 * ServiceSplitTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class ServiceSplitTable extends Doctrine_Table {

	/**
	 * Returns an instance of this class.
	 *
	 * @return object ServiceSplitTable
	 */
	public static function getInstance() {

		return Doctrine_Core::getTable ( 'ServiceSplit' );
	}

	public function getServiceCountCeilMax($service_id) {

		$q = $this->createQuery ( 's' )
			->andWhere ( 's.service_id = ?', $service_id )
			->orderBy ( 's.count_ceil DESC' );
		return $q->fetchOne ();
	}

	/**
	 * FUNCTION: doSelectQuery(Doctrine_Query $query)
	 *
	 * @param
	 *        	Doctrine SQL
	 * @return string SQL
	 *        
	 */
	public function doSelectQuery(Doctrine_Query $query) {

		$query = $this->createQuery ( 'a' );

		$query->select ( 'a.id AS id, ' . 'a.count_value AS count_value, ' . 'a.count_ceil AS count_ceil, ' . 'a.split_value AS split_value, ' . 'a.updated_at AS updated_at,' . 'CONCAT(u.first_name, " ", u.last_name) AS updated_by' );

		$query->leftJoin ( 'a.UserUpdated u' );

		return $query;
	}

	/**
	 * FUNCTION: findByServiceId($service_id)
	 *
	 * @author Nguyen Chien Thang
	 *        
	 * @param int $service_id
	 * @return list obj
	 */
	public function findByServiceId($service_id) {

		$query = $this->createQuery ( 'a' );

		$query->select ( 'a.id AS id, ' . 'a.count_value AS count_value, ' . 'a.count_ceil AS count_ceil, ' . 'a.split_value AS split_value, ' . 'a.updated_at AS updated_at,' . 'CONCAT(u.first_name, " ", u.last_name) AS updated_by' );

		$query->leftJoin ( 'a.UserUpdated u' );
		$query->addWhere ( 'a.service_id = ?', $service_id );

		$query->orderBy ( 'a.count_value' );

		return $query->execute ();
	}
}