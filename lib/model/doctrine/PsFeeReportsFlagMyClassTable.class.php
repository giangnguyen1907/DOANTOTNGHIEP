<?php

/**
 * PsFeeReportsFlagMyClassTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class PsFeeReportsFlagMyClassTable extends Doctrine_Table {

	/**
	 * Returns an instance of this class.
	 *
	 * @return object PsFeeReportsFlagMyClassTable
	 */
	public static function getInstance() {

		return Doctrine_Core::getTable ( 'PsFeeReportsFlagMyClass' );
	}

	/**
	 * Tra ve string SQL lay danh sach lop da chay bao phi cua 1 thang
	 *
	 * @author Nguyen Chien Thang
	 *        
	 * @param mixed $params
	 *        	mang chua cac dieu kien loc
	 * @return string SQL
	 */
	public function setSqlGetListOfParams($params = array()) {

		$sql = $this->createQuery ( 'a' )
			->select ( 'a.id AS id, a.ps_myclass_id AS ps_myclass_id, mc.name as class_name' );

		$sql->innerJoin ( 'a.MyClass mc' );

		$sql->innerJoin ( 'mc.PsClassRooms cr' );

		$sql->innerJoin ( 'cr.PsWorkPlaces wp' );

		if (isset ( $params ['ps_workplace_id'] ) && $params ['ps_workplace_id'] > 0) {
			$sql->where ( 'wp.id = ?', $params ['ps_workplace_id'] );
		}

		if ($params ['receivable_at'] != '')
			$sql->andWhere ( 'DATE_FORMAT(a.receivable_at,"%Y%m") = ?', PsDateTime::psTimetoDate ( $params ['receivable_at'], "Ym" ) );

		return $sql;
	}

	/**
	 * Ham lay chi tiet lan chay bao phi cua 1 lop
	 *
	 * @author Nguyen Chien Thang
	 *        
	 * @param $receivable_at -int
	 *        	time
	 * @param
	 *        	$ps_myclass_id
	 * @return $obj
	 */
	public function getOneObject($ps_myclass_id, $receivable_at) {

		$q = $this->createQuery ( 'a' )
			->select ( 'a.*' )
			->where ( 'a.ps_myclass_id = ?', $ps_myclass_id );

		$q->andWhere ( 'DATE_FORMAT(a.receivable_at,"%Y%m") = ?', PsDateTime::psTimetoDate ( $receivable_at, "Ym" ) );

		return $q->fetchOne ();
	}

	/**
	 * Ham lay chi tiet lan chay bao phi cua 1 lop
	 *
	 * @author Nguyen Chien Thang
	 *        
	 * @param $myclass_ids -
	 *        	mixed
	 * @param $receivable_at -int
	 *        	time
	 * @return $obj
	 */
	public function getListByClassIds($myclass_ids, $receivable_at) {

		$q = $this->createQuery ( 'a' )
			->select ( 'a.*' )
			->whereIn ( 'a.ps_myclass_id', $myclass_ids );

		$q->andWhere ( 'DATE_FORMAT(a.receivable_at,"%Y%m") = ?', PsDateTime::psTimetoDate ( $receivable_at, "Ym" ) );

		return $q->fetchOne ();
	}
}