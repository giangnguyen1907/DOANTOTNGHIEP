<?php

/**
 * ServiceGroupTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class ServiceGroupTable extends Doctrine_Table {

	/**
	 * Returns an instance of this class.
	 *
	 * @return object ServiceGroupTable
	 */
	public static function getInstance() {

		return Doctrine_Core::getTable ( 'ServiceGroup' );
	}

	public function getServiceGroupList($servicegroup) {

		foreach ( $servicegroup as $value ) {
			$c [$value->getId ()] = $value->getTitle ();
		}
		return $c;
	}

	/**
	 * FUNCTION: doSelectQuery(Doctrine_Query $query)
	 *
	 * @param
	 *        	Doctrine SQL
	 * @return string SQL
	 */
	public function doSelectQuery(Doctrine_Query $query) {

		$alias = $query->getRootAlias ();

		$query->select ( $alias . '.title,' . $alias . '.note,' . $alias . '.iorder, ' . $alias . '.updated_at,' . $alias . '.user_updated_id, ' . 'cus.title AS customer_title, ' . 'CONCAT(u.first_name," ",u.last_name) AS updated_by' )
			->
		innerJoin ( $alias . '.PsCustomer cus' )
			->
		leftJoin ( $alias . '.UserUpdated u' );

		if (! myUser::credentialPsCustomers ( 'PS_STUDENT_SERVICE_GROUP_FILTER_SCHOOL' ) && myUser::getPscustomerID () > 0)
			$query->addWhere ( $alias . '.ps_customer_id = ?', ( int ) myUser::getPscustomerID () );

		return $query;
	}

	/**
	 * Tao SQL lay danh sach ServiceGroup
	 *
	 * @return $sql - string
	 */
	public function setSQLServiceGroup($getField = 'id, title', $psCustomerId = null) {

		$q = $this->createQuery ()
			->select ( $getField != '' ? $getField : '*' );

		if ($psCustomerId > 0)
			$q->addWhere ( 'ps_customer_id = ?', $psCustomerId );

		$q->addOrderBy ( 'iorder' );

		return $q;
	}

	/**
	 * Lay so luong nhom dich vu cua truong hoc
	 *
	 * @author thangnc
	 *        
	 * @param
	 *        	ps_customer_id
	 * @return int
	 */
	public function getNumberServiceGroupByCustomerId($ps_customer_id) {

		$query = $this->createQuery ( 'a' )
			->select ( 'a.id' )
			->addWhere ( 'a.ps_customer_id = ?', $ps_customer_id )
			->count ();

		return $query;
	}
}