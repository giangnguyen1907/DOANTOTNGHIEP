<?php

/**
 * RecurrenceServiceTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class RecurrenceServiceTable extends Doctrine_Table {

	/**
	 * Returns an instance of this class.
	 *
	 * @return object RecurrenceServiceTable
	 */
	public static function getInstance() {

		return Doctrine_Core::getTable ( 'RecurrenceService' );
	}

	/**
	 * Tim xem co ton tai gia tri duoc tinh lai cua nguoi dung khong
	 *
	 * @param unknown_type $student_id:
	 *        	id hoc sinh
	 * @param unknown_type $service_id:
	 *        	id dich vu
	 * @param timestamp $date:
	 *        	Ngay nhap du lieu
	 */
	public function getAmountByStudentService($student_id, $service_id, $date) {

		$q = $this->createQuery ( 'c' )
			->innerJoin ( 'c.StudentService ss' )
			->andWhere ( 'student_id = ?', $student_id )
			->andWhere ( 'service_id = ?', $service_id )
			->andWhere ( 'effectives_at <= ?', date ( 'Y-m-d 00:00', $date ) )
			->andWhere ( 'expires_at >= ?', date ( 'Y-m-d 00:00', $date ) );

		return $q->fetchOne ();
	}

	/**
	 * Tim ban ghi de Xoa hoac Update
	 *
	 * @param ing $student_id
	 *        	- ma hoc sinh
	 * @param ing $service_id
	 *        	- ma dich vu
	 * @param datetime $recurrence_at
	 *        	- thoi gian check
	 * @return Object
	 */
	public function findOneRecurrenceService($student_id, $service_id, $recurrence_at) {

		$q = $this->createQuery ( 'c' )
			->innerJoin ( 'c.StudentService ss' )
			->andWhere ( 'student_id = ?', $student_id )
			->andWhere ( 'service_id = ?', $service_id )
			->andWhere ( 'DATE_FORMAT(recurrence_at,"%Y%m") = ?', date ( 'Ym', $recurrence_at ) );

		return $q->fetchOne ();
	}
}