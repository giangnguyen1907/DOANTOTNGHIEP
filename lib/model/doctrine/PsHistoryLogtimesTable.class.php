<?php

/**
 * PsHistoryLogtimesTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class PsHistoryLogtimesTable extends Doctrine_Table {

	/**
	 * Returns an instance of this class.
	 *
	 * @return object PsHistoryLogtimesTable
	 */
	public static function getInstance() {

		return Doctrine_Core::getTable ( 'PsHistoryLogtimes' );
	}

	/**
	 * Hien thi lich su diem danh
	 *
	 * @author Phung Van Thanh
	 */
	public function getHistoryLogtimes($student_id, $date_at_from = null, $date_at_to = null) {

		// echo $student_id; die();
		$q = $this->createQuery ( 'hlt' )
			->select ( 'hlt.id, hlt.ps_action, hlt.history_content,hlt.student_id, hlt.created_at' );
		if ($student_id > 0)
			$q->addWhere ( 'hlt.student_id =?', $student_id );

		if ($date_at_from != '')
			$q->andWhere ( ' DATE_FORMAT(hlt.created_at,"%Y%m%d") >= ?', date ( "Ymd", strtotime ( $date_at_from ) ) );

		if ($date_at_to != '')
			$q->andWhere ( ' DATE_FORMAT(hlt.created_at,"%Y%m%d") <= ?', date ( "Ymd", strtotime ( $date_at_to ) ) );

		$q->orderBy ( 'hlt.created_at desc' );

		return $q->execute ();
	}
}