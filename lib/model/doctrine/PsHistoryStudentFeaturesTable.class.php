<?php

/**
 * PsHistoryStudentFeaturesTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class PsHistoryStudentFeaturesTable extends Doctrine_Table {

	/**
	 * Returns an instance of this class.
	 *
	 * @return object PsHistoryStudentFeaturesTable
	 */
	public static function getInstance() {

		return Doctrine_Core::getTable ( 'PsHistoryStudentFeatures' );
	}

	/**
	 * Hien thi lich su danh gia hoat dong cua hoc sinh
	 *
	 * @author Phung Van Thanh
	 */
	public function getHistoryStudentFeatures($student_id, $date_at_from = null, $date_at_to = null) {

		// echo $student_id; die();
		$q = $this->createQuery ( 'hsf' )
			->select ( 'hsf.id, hsf.ps_action, hsf.history_content, hsf.created_at' );
		if ($student_id > 0)
			$q->addWhere ( 'hsf.student_id = ?', $student_id );

		if ($date_at_from != '')
			$q->andWhere ( ' DATE_FORMAT(hsf.created_at,"%Y%m%d") >= ?', date ( "Ymd", strtotime ( $date_at_from ) ) );
		if ($date_at_to != '')
			$q->andWhere ( ' DATE_FORMAT(hsf.created_at,"%Y%m%d") <= ?', date ( "Ymd", strtotime ( $date_at_to ) ) );

		$q->orderBy ( 'hsf.created_at desc' );

		return $q->execute ();
	}
}